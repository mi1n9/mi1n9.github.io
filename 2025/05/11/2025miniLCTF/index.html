<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="owo 题目质量感觉还蛮高。学到了一些东西。只是可惜知道的时候已经快结束了，没啥时间打。现在来复现一下">
<meta property="og:type" content="article">
<meta property="og:title" content="2025miniLCTF">
<meta property="og:url" content="http://example.com/2025/05/11/2025miniLCTF/index.html">
<meta property="og:site_name" content="浮白载笔">
<meta property="og:description" content="owo 题目质量感觉还蛮高。学到了一些东西。只是可惜知道的时候已经快结束了，没啥时间打。现在来复现一下">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-05-11T07:19:31.000Z">
<meta property="article:modified_time" content="2025-05-27T11:55:39.183Z">
<meta property="article:author" content="mi1n9">
<meta property="article:tag" content="WP">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/05/11/2025miniLCTF/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/05/11/2025miniLCTF/","path":"2025/05/11/2025miniLCTF/","title":"2025miniLCTF"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2025miniLCTF | 浮白载笔</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?841f86b735a025664beab6e082daa3d3"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">浮白载笔</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">苍山负雪，明烛天南</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>links</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1%EF%BC%8Cbabaisiginsigin"><span class="nav-number">1.</span> <span class="nav-text">1，babaisiginsigin</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2%EF%BC%8Crsasign"><span class="nav-number">2.</span> <span class="nav-text">2，rsasign</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3%EF%BC%8Cezhash%EF%BC%9F%EF%BC%81"><span class="nav-number">3.</span> <span class="nav-text">3，ezhash？！</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4%EF%BC%8CNoisy"><span class="nav-number">4.</span> <span class="nav-text">4，Noisy</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="mi1n9"
      src="https://q.qlogo.cn/headimg_dl?dst_uin=2605742754&spec=640&img_type=jpg">
  <p class="site-author-name" itemprop="name">mi1n9</p>
  <div class="site-description" itemprop="description">夜将寒色去，年共晓光新</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1403921843&auto=1&height=66"></iframe>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/11/2025miniLCTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://q.qlogo.cn/headimg_dl?dst_uin=2605742754&spec=640&img_type=jpg">
      <meta itemprop="name" content="mi1n9">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浮白载笔">
      <meta itemprop="description" content="夜将寒色去，年共晓光新">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2025miniLCTF | 浮白载笔">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2025miniLCTF
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-05-11 15:19:31" itemprop="dateCreated datePublished" datetime="2025-05-11T15:19:31+08:00">2025-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-05-27 19:55:39" itemprop="dateModified" datetime="2025-05-27T19:55:39+08:00">2025-05-27</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>42k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:16</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>owo</p>
<p>题目质量感觉还蛮高。学到了一些东西。只是可惜知道的时候已经快结束了，没啥时间打。现在来复现一下</p>
<span id="more"></span>

<h1 id="1，babaisiginsigin"><a href="#1，babaisiginsigin" class="headerlink" title="1，babaisiginsigin"></a>1，babaisiginsigin</h1><p>z3一把梭XD，顺便学了一下z3的使用，之前没咋用过。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_level1</span>(<span class="params">m, x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> (m | x) + (m | y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_level2</span>(<span class="params">m, x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> (m | x) + (m ^ y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">level</span>(<span class="params">conn, calculate, x, y, guess, description, test_times</span>):</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(test_times):</span><br><span class="line">        conn.sendall(<span class="string">b&quot;Enter your number: &quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置 5 秒超时</span></span><br><span class="line">        conn.settimeout(<span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                test = <span class="built_in">int</span>(data.strip())</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                conn.sendall(<span class="string">b&quot;Invalid input. Bye.\n&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            result = calculate(test, x, y)</span><br><span class="line">            conn.sendall(<span class="string">f&quot;Calculation result: <span class="subst">&#123;result&#125;</span>\n&quot;</span>.encode())</span><br><span class="line">        <span class="keyword">except</span> socket.timeout:</span><br><span class="line">            conn.sendall(<span class="string">b&quot;Time out! Respond in 5 seconds.\n&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    conn.sendall(<span class="string">f&quot;\nNow, guess the result of <span class="subst">&#123;description&#125;</span> for m = <span class="subst">&#123;guess&#125;</span>:\n&quot;</span>.encode())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置 5 秒超时</span></span><br><span class="line">    conn.settimeout(<span class="number">5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user_guess = <span class="built_in">int</span>(data.strip())</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            conn.sendall(<span class="string">b&quot;Invalid input. Bye.\n&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        correct_result = calculate(guess, x, y)</span><br><span class="line">        <span class="keyword">if</span> user_guess == correct_result:</span><br><span class="line">            conn.sendall(<span class="string">b&quot;Correct! Proceeding to next level...\n\n&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            conn.sendall(<span class="string">b&quot;Wrong guess! Exiting...\n&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span> socket.timeout:</span><br><span class="line">        conn.sendall(<span class="string">b&quot;Time out! You took too long to respond.\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_client</span>(<span class="params">conn, addr, flag</span>):</span><br><span class="line">    conn.sendall(<span class="string">b&quot;Welcome to Puzzle!\n\n&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Level 1</span></span><br><span class="line">        x = random.getrandbits(<span class="number">30</span>)</span><br><span class="line">        y = random.getrandbits(<span class="number">30</span>)</span><br><span class="line">        guess = random.getrandbits(<span class="number">30</span>)</span><br><span class="line">        conn.sendall(<span class="string">b&quot;Level 1:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> level(conn, calculate_level1, x, y, guess, <span class="string">&quot;(m | x) + (m | y)&quot;</span>, test_times=<span class="number">2</span>):</span><br><span class="line">            conn.close()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Level 2</span></span><br><span class="line">        x = random.getrandbits(<span class="number">30</span>)</span><br><span class="line">        y = random.getrandbits(<span class="number">30</span>)</span><br><span class="line">        guess = random.getrandbits(<span class="number">30</span>)</span><br><span class="line">        conn.sendall(<span class="string">b&quot;Level 2:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> level(conn, calculate_level2, x, y, guess, <span class="string">&quot;(m | x) + (m ^ y)&quot;</span>, test_times=<span class="number">2</span>):</span><br><span class="line">            conn.close()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 通关，发flag</span></span><br><span class="line">        conn.sendall(<span class="string">f&quot;Congratulations! You&#x27;ve passed all levels!\nHere is your flag: <span class="subst">&#123;flag&#125;</span>\n&quot;</span>.encode())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        conn.sendall(<span class="string">b&quot;An error occurred. Bye.\n&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    host = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    port = <span class="number">2227</span></span><br><span class="line"></span><br><span class="line">    flag = os.getenv(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">&#x27;flag&#123;testflag&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.bind((host, port))</span><br><span class="line">    s.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Listening on <span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;port&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, addr = s.accept()</span><br><span class="line">        threading.Thread(target=handle_client, args=(conn, addr, flag)).start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>题目流程很简单。给出level1和level2，对于每个level有两次尝试机会。用户可自定义输入，交互会返回计算值，而通关条件是计算出给定m的结果。那很明显我们需要得到x，y的某种关系或者直接算出x，y才能计算。我一开始推了很久结果发现可以z3一把梭(z3神力！),脚本写的详细一点顺便再复习一下z3的使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_level1</span>(<span class="params">m, x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> (m | x) + (m | y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_level2</span>(<span class="params">m, x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> (m | x) + (m ^ y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m1 = <span class="number">15</span>*<span class="string">&quot;10&quot;</span></span><br><span class="line">m1 = <span class="built_in">int</span>(m1, <span class="number">2</span>)</span><br><span class="line">m2 = <span class="number">15</span>*<span class="string">&quot;01&quot;</span></span><br><span class="line">m2 = <span class="built_in">int</span>(m2, <span class="number">2</span>)</span><br><span class="line">io = remote(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">28434</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># level 1</span></span><br><span class="line">io.recv()</span><br><span class="line">io.send(<span class="string">f&quot;<span class="subst">&#123;m1&#125;</span>&quot;</span>.encode())</span><br><span class="line"><span class="comment">#io.recv()</span></span><br><span class="line"><span class="comment"># print(io.recv())</span></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Calculation result: &quot;</span>)</span><br><span class="line"><span class="comment"># r1 = eval(io.recv().split(b&quot;Calculation result: &quot;)[1])</span></span><br><span class="line">r1 = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(r1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(io.recv())</span><br><span class="line"><span class="comment">#print(io.recv())</span></span><br><span class="line">io.send(<span class="string">f&quot;<span class="subst">&#123;m2&#125;</span>&quot;</span>.encode())</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Calculation result: &quot;</span>)</span><br><span class="line">r2 = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line">m = <span class="built_in">eval</span>(io.recv().split(<span class="string">b&quot;m = &quot;</span>)[-<span class="number">1</span>][:-<span class="number">2</span>])</span><br><span class="line">x = BitVec(<span class="string">&#x27;x&#x27;</span>, <span class="number">30</span>)</span><br><span class="line">y = BitVec(<span class="string">&#x27;y&#x27;</span>, <span class="number">30</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add((m1 | x) + (m1 | y)==r1)</span><br><span class="line">s.add((m2 | x) + (m2 | y)==r2)</span><br><span class="line"><span class="keyword">if</span> s.check() != sat:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;false&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line">    x = s.model().<span class="built_in">eval</span>(x).py_value()</span><br><span class="line">    y = s.model().<span class="built_in">eval</span>(y).py_value()</span><br><span class="line">    res = calculate_level1(m, x, y)</span><br><span class="line">    io.send(<span class="string">f&quot;<span class="subst">&#123;res&#125;</span>&quot;</span>.encode())</span><br><span class="line"><span class="built_in">print</span>(io.recv())</span><br><span class="line"></span><br><span class="line"><span class="comment"># level 2</span></span><br><span class="line"></span><br><span class="line">io.send(<span class="string">f&quot;<span class="subst">&#123;m1&#125;</span>&quot;</span>.encode())</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Calculation result: &quot;</span>)</span><br><span class="line"><span class="comment"># r1 = eval(io.recv().split(b&quot;Calculation result: &quot;)[1])</span></span><br><span class="line">r1 = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(r1)</span><br><span class="line"><span class="built_in">print</span>(io.recv())</span><br><span class="line">io.send(<span class="string">f&quot;<span class="subst">&#123;m2&#125;</span>&quot;</span>.encode())</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Calculation result: &quot;</span>)</span><br><span class="line">r2 = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line">m = <span class="built_in">eval</span>(io.recv().split(<span class="string">b&quot;m = &quot;</span>)[-<span class="number">1</span>][:-<span class="number">2</span>])</span><br><span class="line">x = BitVec(<span class="string">&#x27;x&#x27;</span>, <span class="number">30</span>)</span><br><span class="line">y = BitVec(<span class="string">&#x27;y&#x27;</span>, <span class="number">30</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add((m1 | x) + (m1 ^ y)==r1)</span><br><span class="line">s.add((m2 | x) + (m2 ^ y)==r2)</span><br><span class="line"><span class="keyword">if</span> s.check() != sat:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;false&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line">    x = s.model().<span class="built_in">eval</span>(x).py_value()</span><br><span class="line">    y = s.model().<span class="built_in">eval</span>(y).py_value()</span><br><span class="line">    res = calculate_level2(m, x, y)</span><br><span class="line">    io.send(<span class="string">f&quot;<span class="subst">&#123;res&#125;</span>&quot;</span>.encode())</span><br><span class="line"><span class="built_in">print</span>(io.recv())</span><br></pre></td></tr></table></figure>

<p>官方wp里有句话感觉很有意义“用最合适的工具解决最合适的问题，Gurobi 解决线性优化最快，SAT 求解器解决布尔逻辑最快，Z3 处理复杂混合逻辑最灵活。”确实选择了合适的工具效率会大大提升。</p>
<h1 id="2，rsasign"><a href="#2，rsasign" class="headerlink" title="2，rsasign"></a>2，rsasign</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime, inverse</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genKeys</span>(<span class="params">nbits</span>):</span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    p = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">    q = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = n - (p + q) + <span class="number">1</span></span><br><span class="line">    d = inverse(e, phi)</span><br><span class="line">    pubkey = (n, e)</span><br><span class="line">    prikey = (d, p, q)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> pubkey, prikey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pubkey</span>):</span><br><span class="line">    m = bytes_to_long(msg)</span><br><span class="line">    n, e = pubkey</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_gift</span>(<span class="params">prikey</span>):</span><br><span class="line">    a = bytes_to_long(<span class="string">b&#x27;miniL&#x27;</span>)</span><br><span class="line">    b = bytes_to_long(<span class="string">b&#x27;mini7&#x27;</span>)</span><br><span class="line">    p, q = prikey[<span class="number">1</span>:]</span><br><span class="line">    phi = (p - <span class="number">1</span>)*(q - <span class="number">1</span>)</span><br><span class="line">    giftp = p + a</span><br><span class="line">    giftq = q + b</span><br><span class="line">    gift = <span class="built_in">pow</span>((giftp + giftq + a*b), <span class="number">2</span>, phi)</span><br><span class="line">    <span class="keyword">return</span> gift &gt;&gt; <span class="number">740</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    nbits = <span class="number">1024</span></span><br><span class="line">    pubkey, prikey = genKeys(nbits)</span><br><span class="line">    c = encrypt(flag, pubkey)</span><br><span class="line">    gift = get_gift(prikey)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&#x27;pubkey = &#x27;</span> + <span class="built_in">str</span>(pubkey) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        f.write(<span class="string">&#x27;c = &#x27;</span> + <span class="built_in">str</span>(c) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        f.write(<span class="string">&#x27;gift = &#x27;</span> + <span class="built_in">str</span>(gift) + <span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>关键函数为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_gift</span>(<span class="params">prikey</span>):</span><br><span class="line">    a = bytes_to_long(<span class="string">b&#x27;miniL&#x27;</span>)</span><br><span class="line">    b = bytes_to_long(<span class="string">b&#x27;mini7&#x27;</span>)</span><br><span class="line">    p, q = prikey[<span class="number">1</span>:]</span><br><span class="line">    phi = (p - <span class="number">1</span>)*(q - <span class="number">1</span>)</span><br><span class="line">    giftp = p + a</span><br><span class="line">    giftq = q + b</span><br><span class="line">    gift = <span class="built_in">pow</span>((giftp + giftq + a*b), <span class="number">2</span>, phi)</span><br><span class="line">    <span class="keyword">return</span> gift &gt;&gt; <span class="number">740</span></span><br></pre></td></tr></table></figure>

<p>因为a和b都只有30位，把gift展开一下，约等于是(p+q)$^2$+kphi,我们自己生成几组数据不难发现k为4，用结式联立一下p*q&#x3D;n就能得到p，q之一的高位(这里尝试过grobner基不过没出，看来对于未知量少的还是结式比较nb)。然后用普通的p高位泄露去打就行啦。</p>
<p>打结式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="comment">#from sage.matrix.matrix2 import Matrix</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resultant</span>(<span class="params">f1, f2, var</span>):</span><br><span class="line">    <span class="keyword">return</span> Matrix.determinant(f1.sylvester_matrix(f2, var))</span><br><span class="line">n=<span class="number">103894244981844985537754880154957043605938484102562158690722531081787219519424572416881754672377601851964416424759136080204870893054485062449999897173374210892603308440838199225926262799093152616430249061743215665167990978654674200171059005559869946978592535720766431524243942662028069102576083861914106412399</span></span><br><span class="line">gift =<span class="number">2391232579794490071131297275577300947901582900418236846514147804369797358429972790212</span></span><br><span class="line">gift=gift&lt;&lt;<span class="number">740</span></span><br><span class="line">p, q = QQ[<span class="string">&#x27;x, y&#x27;</span>].gens()</span><br><span class="line">f =n-p*q</span><br><span class="line">g = (p+q)**<span class="number">2</span>-<span class="number">4</span>*(n-(p+q)+<span class="number">1</span>) - gift</span><br><span class="line">h = f.resultant(g, q)</span><br><span class="line"><span class="built_in">print</span>([f, g])</span><br><span class="line"><span class="built_in">print</span>([h, factor(h)])</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(RealField(<span class="number">1000</span>))</span><br><span class="line">h = PR(h)</span><br><span class="line"><span class="built_in">print</span>(h)</span><br><span class="line">res =h.monic().roots()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<p>经过测试发现得到的p的高229位是准确的，太有心机了刚好卡在epsilon的界上。</p>
<p>（以512bit的p为例)</p>
<p>当<code>beta=0.4</code>时，在未知位数少于等于227bit时，可以恢复p</p>
<p>当<code>beta=0.4,epsilon=0.01</code>时，在未知位数少于等于248bit时，可以恢复p</p>
<p>加一下epsilon的参数直接打即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="number">50810871938251627005285090837280618434273429940089654925377752488011128518767341675465435906094867261596016363149398900195250354993172711611856393548098646094748785774924511077105061611095328649875874203921275281780733446616807977350320544877201182003521199057295967111877565671671198186635360508565083698058</span></span><br><span class="line">n=<span class="number">103894244981844985537754880154957043605938484102562158690722531081787219519424572416881754672377601851964416424759136080204870893054485062449999897173374210892603308440838199225926262799093152616430249061743215665167990978654674200171059005559869946978592535720766431524243942662028069102576083861914106412399</span></span><br><span class="line">gift =<span class="number">2391232579794490071131297275577300947901582900418236846514147804369797358429972790212</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(<span class="number">8.50163959012197759505352373881837525967941479473010602057836865805627052910871914284361623987618060959240804297171916281996509283848634874980052464884478767329803877247851607313541184922319727944953935066659961095394358139432989452855479778189020778762947568782629837455544564537937538688849538209838e153</span>))</span><br><span class="line">ph=<span class="number">8501639590121977595053523738818375259679414794730106020578368658056270529108719142843616239876180609592408042971719162819965092838486348749800524648844787</span></span><br><span class="line">p_high=ph&gt;&gt;<span class="number">229</span>&lt;&lt;<span class="number">229</span></span><br><span class="line"><span class="built_in">print</span>(p_high)</span><br><span class="line"><span class="built_in">print</span>(p_high.bit_length())</span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = p_high + x</span><br><span class="line">res = f.small_roots(X = <span class="number">2</span>^<span class="number">229</span>,beta=<span class="number">0.4</span>,epsilon=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">if</span> res != []:</span><br><span class="line">    p = p_high + <span class="built_in">int</span>(res[<span class="number">0</span>])</span><br><span class="line">    q = n // p</span><br><span class="line">    <span class="built_in">print</span>(p*q-n)</span><br><span class="line">    d = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>

<h1 id="3，ezhash？！"><a href="#3，ezhash？！" class="headerlink" title="3，ezhash？！"></a>3，ezhash？！</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shash</span>(<span class="params">value,key</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">type</span>(value) == <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">type</span>(key) == <span class="built_in">int</span></span><br><span class="line">    length = <span class="built_in">len</span>(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    mask = <span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line">    x = (<span class="built_in">ord</span>(value[<span class="number">0</span>]) &lt;&lt; <span class="number">7</span>) &amp; mask</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> value:</span><br><span class="line">        x = (key * x) &amp; mask ^ <span class="built_in">ord</span>(c)</span><br><span class="line"></span><br><span class="line">    x ^= length &amp; mask</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_test</span>(<span class="params">key</span>):</span><br><span class="line"></span><br><span class="line">    testvalue = []</span><br><span class="line">    testhash = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        a = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.ascii_letters + string.digits, k=<span class="number">32</span>)) </span><br><span class="line">        testvalue.append(a)</span><br><span class="line">        testhash.append(shash(a,key))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> testvalue,testhash</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">32</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">type</span>(flag) == <span class="built_in">str</span></span><br><span class="line">    key = getRandomInteger(<span class="number">128</span>)</span><br><span class="line">    testvalue,testhash = get_test(key)</span><br><span class="line">    shash = shash(flag,key)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&#x27;testvalue = &#x27;</span> + <span class="built_in">str</span>(testvalue) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        f.write(<span class="string">&#x27;testhash = &#x27;</span> + <span class="built_in">str</span>(testhash) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        f.write(<span class="string">&#x27;shash = &#x27;</span> + <span class="built_in">str</span>(shash) + <span class="string">&#x27;\n&#x27;</span>)        </span><br></pre></td></tr></table></figure>

<p>刚看到题目就想到了去年国赛的那道hash，去翻了翻发现还真是差不多，唯一的一点差别是这道题没给出key。那么我们咋求key呢。我们来看看shash和gettest函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">shash</span>(<span class="params">value,key</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">type</span>(value) == <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">type</span>(key) == <span class="built_in">int</span></span><br><span class="line">    length = <span class="built_in">len</span>(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    mask = <span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line">    x = (<span class="built_in">ord</span>(value[<span class="number">0</span>]) &lt;&lt; <span class="number">7</span>) &amp; mask</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> value:</span><br><span class="line">        x = (key * x) &amp; mask ^ <span class="built_in">ord</span>(c)</span><br><span class="line"></span><br><span class="line">    x ^= length &amp; mask</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_test</span>(<span class="params">key</span>):</span><br><span class="line"></span><br><span class="line">    testvalue = []</span><br><span class="line">    testhash = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        a = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.ascii_letters + string.digits, k=<span class="number">32</span>)) </span><br><span class="line">        testvalue.append(a)</span><br><span class="line">        testhash.append(shash(a,key))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> testvalue,testhash</span><br></pre></td></tr></table></figure>

<p>我们可以发现testhash是key和 testvalue经过shash运算得到的结果。那么很明显啦，z3神力！使用一组test就能得到key。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib, binascii</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入数据（替换为实际数据）</span></span><br><span class="line">testvalue = [<span class="string">&#x27;tx4QYfj3lCTABrCoMsh3PPvQIM7dmIIw&#x27;</span>, <span class="string">&#x27;jKLrKVRVpjjyrchL41IjMVkQMgSkyyig&#x27;</span>, <span class="string">&#x27;fdbfg4185rfRJyhwCwc2flhmsCDuVOe8&#x27;</span>, <span class="string">&#x27;ZL8h1XOKVNXkVh1ZcCHhDUvF4FO96139&#x27;</span>, <span class="string">&#x27;HcDKLC1iMwoiWoGxaC5VNC78VHLt5JOI&#x27;</span>, <span class="string">&#x27;GzGJsONsN8GSZxh6C89w0nzRiTaR3tkj&#x27;</span>, <span class="string">&#x27;Qcc9vqEBGXYd8sZ3E94Ode6ChC3U53x7&#x27;</span>, <span class="string">&#x27;kABKm4mE7AttOzac3eBXvIxKE9Ve0viT&#x27;</span>, <span class="string">&#x27;IkxnSW31AuUGpVldXGopAxfzr5eTXc2u&#x27;</span>, <span class="string">&#x27;rJ2LZ0uDPCWEwJzaGGalaWWHBbxrLH4h&#x27;</span>, <span class="string">&#x27;bOlXdB5xVb2RQO0MAhLvzgOZpEo2hIdP&#x27;</span>, <span class="string">&#x27;gRhoDgyxFFV5kBLwZxexhoHNd5BD81UE&#x27;</span>, <span class="string">&#x27;Ij86fy7zhVOaapV76xI71IUC8utF6Ct6&#x27;</span>, <span class="string">&#x27;T055KPGIWKhNIEPxAKW4MLMbmWDvEnLb&#x27;</span>, <span class="string">&#x27;SQSSYTFryov8Bp1ckfjbUTTV8H3Z3Dr7&#x27;</span>, <span class="string">&#x27;AzfvT7z8NXJ9u8ID6vgJ8Zml58F2k0iF&#x27;</span>, <span class="string">&#x27;o3nEYw9XaNzgetmmwypTU7oePU04Tkhc&#x27;</span>, <span class="string">&#x27;B44YjfhqOrlPg8XQJq2fhWEoGaCijfsc&#x27;</span>, <span class="string">&#x27;b7cvfUfjvorVjDBW6DiXrZc3eBqx98Ro&#x27;</span>, <span class="string">&#x27;9MwfbmLtdmRRt0TONZ4zmd6NN7z7V8Eg&#x27;</span>, <span class="string">&#x27;2f7I0f65nopjOpIZzErAoqYSGl0tMo0x&#x27;</span>, <span class="string">&#x27;PqvrJ3FmEuJh1ASIQ06RyYCXbe6426CY&#x27;</span>, <span class="string">&#x27;c3C60OTDrIs5ZChP2hTAYvViDw43ARCK&#x27;</span>, <span class="string">&#x27;D6a0NJ2JpwtTBCRJdw1DcXntMgRRyj2A&#x27;</span>, <span class="string">&#x27;gJ0rEL4zyy8A6aKZ1H3N46rsQnY6UGGx&#x27;</span>, <span class="string">&#x27;CD19v37d2jHu9YZMp20h70sm1Q3t1yOm&#x27;</span>, <span class="string">&#x27;7vt0C1SCNvPBqBm0YrJffbeLG8vS8388&#x27;</span>, <span class="string">&#x27;o2KRrZQJLD7CMuLzlPJoJHXwVOHEanBi&#x27;</span>, <span class="string">&#x27;Lm8I9m5ikXVrguEUFKw6yIc9QWnLwisx&#x27;</span>, <span class="string">&#x27;kt9H0IDCsjCfqkR83aHD8D23jXq55q5K&#x27;</span>, <span class="string">&#x27;HsXBVD2dMVTScHfgwAeNsqHkLCWuuaVn&#x27;</span>, <span class="string">&#x27;QnkXRLGjzfh16icAVidcW4kVx1LEOv0j&#x27;</span>, <span class="string">&#x27;29dQWe0QWOxNAhv48Lfnv8II4IZqeUh1&#x27;</span>, <span class="string">&#x27;E9Hj5zUhGXUfrNJRmhxF0KfBq0wSjX0i&#x27;</span>, <span class="string">&#x27;mEc57IdmvliXneKStFzb3pAnNNm4UHbh&#x27;</span>, <span class="string">&#x27;TvRZb6btVQeKXsO5iVuRCdz3A4ORZ5yQ&#x27;</span>, <span class="string">&#x27;yOfrPTw9Vkd0P7kiijnGVYL4SogWF7cY&#x27;</span>, <span class="string">&#x27;GNI7o11w4RyXYY2hnxdq1mAeVPrppkRc&#x27;</span>, <span class="string">&#x27;YCMxUi7OcB5xozjTg09xXbJvwM6U4apy&#x27;</span>, <span class="string">&#x27;0g6ItBFoe3174e7wpEaEgoid0rixLHBs&#x27;</span>, <span class="string">&#x27;bsyXlUGPUnQjoNwQLROwrA2SCkbDR1k5&#x27;</span>, <span class="string">&#x27;CMNSNW3fU14ibZgL0ifWrA0xbbq7Yrks&#x27;</span>, <span class="string">&#x27;VHfbRmzF9mzGCbYySdljWWo08IVCmAMZ&#x27;</span>, <span class="string">&#x27;SLfmmSZ5TjDc4ZfKIB2gOVf9KIH2jDUi&#x27;</span>, <span class="string">&#x27;YKTagkUhZjI0gMyaE1YjVJdCYtPGPZge&#x27;</span>, <span class="string">&#x27;kCVhCGvjedxC44BlTqQryGdMliYqYrIz&#x27;</span>, <span class="string">&#x27;HflxuwlJZ2rByOnv995gpXz03ZK6MLW2&#x27;</span>, <span class="string">&#x27;8Yy45IMlpMhDO3CFVhr5f0iRBnNuj3ut&#x27;</span>, <span class="string">&#x27;Ydae2l7kt1O6mCIBRwjr6TWn6fLRHXjf&#x27;</span>, <span class="string">&#x27;3cLGeEXfyLnrL0ZkvgSEAbDBYgaFNFxB&#x27;</span>, <span class="string">&#x27;97xOFim3lkwqrWM1BqQ7c8mYo5S5TxkC&#x27;</span>, <span class="string">&#x27;U1EgvNhZz3M8Hg38FsuBVG0PvuWiCfez&#x27;</span>, <span class="string">&#x27;1elLy7dgdfEtb2XyZMxaU6h8dGjfokjv&#x27;</span>, <span class="string">&#x27;FlSHFSs2SeKNOUVAprkHdtD2FrIPUGIR&#x27;</span>, <span class="string">&#x27;Bu1pVMZ5QqMmvBTdUt4IwsTpkclqwQKF&#x27;</span>, <span class="string">&#x27;BPzJvHHDTAu23xBS1wVButTF7lU0JGoo&#x27;</span>, <span class="string">&#x27;6xje2blSl3QwGeV9D4pUmxMKJDqpyXpt&#x27;</span>, <span class="string">&#x27;F2DkyxkRcHotO6i5MVUKzzDsxV2F69wh&#x27;</span>, <span class="string">&#x27;kvSYBqmZNppDfweere2A8co50Tv85c4m&#x27;</span>, <span class="string">&#x27;9k5gxX8oz1WmVLtCcN4SdFIse2FizYDU&#x27;</span>, <span class="string">&#x27;BJ2PCD5KgukjFWntZ3VSjcHJzIZprno2&#x27;</span>, <span class="string">&#x27;Lyw9EacIjF6j6de3e5wFRQLdzrOfQoAR&#x27;</span>, <span class="string">&#x27;egf9LJLJrWDIrtnsHZ4XRgoPTXNsz91a&#x27;</span>, <span class="string">&#x27;Y3ptIW83Rwtny4kng2lCEAYQyPrSIXWl&#x27;</span>]</span><br><span class="line">testhash = [<span class="number">139452903649273495774796570198749847935154848275416989998236609393670079561796026566</span>, <span class="number">1898315960650462382992557075551445244853390783794354772475023552166352399126801574913</span>, <span class="number">1548283380348601157365276865178627465508293067676981633220766480841355279423253644108</span>, <span class="number">923519463377078549688929962730292019193308698763374121309865664233390770048594933085</span>, <span class="number">1756902502089018688726236312608077708484907801835749190713532913735823397112051091188</span>, <span class="number">485883566823442644293538461674550566921074196968613685770142417532151624958507107972</span>, <span class="number">1173292014155884160226339046019271687659068020981556335907768031140876583959335792191</span>, <span class="number">1497598230931219654402725391331476099708291441530945577907300933091011484442911623559</span>, <span class="number">405254852716971084666570344588562007424273706832802434925282540786042396564117859893</span>, <span class="number">1394088214004563872208003758992014976825245306078851263986862009024422531466462221196</span>, <span class="number">1763510459716348629512798257958014024443432479861579028783119470126357343664438877507</span>, <span class="number">27569271776233701581922903599984775754217802504994237075390721310066121958700422257</span>, <span class="number">358721799072196562200934505713368644637409165736588969777736471282788507457480492393</span>, <span class="number">393768200956019495628870433474843666326783653588854234548113046584760291662872350533</span>, <span class="number">1807499005738194381232046747643492968233097104171420081977957810644000450496758434126</span>, <span class="number">1128375044917910760907836056160281710737671148936596789317429758098492329675588054412</span>, <span class="number">190801904376187850882600897701548299608718300961575858190394579710450430805489346060</span>, <span class="number">696235869802737571933351613461601576350495964954926712734858661433694663819119664403</span>, <span class="number">144629031178782625524039663692148786536912021223673544659451459599242746855791775856</span>, <span class="number">401144481698447351083363386545760097487182143265029898145794033656496473914256697335</span>, <span class="number">1009618288798575771577716476700225261222418219966898563557126734083036472365735018549</span>, <span class="number">1652157599124169823165290864340613818899678030477803381010155627950330279311151902666</span>, <span class="number">1870720516435595720338243705356357230346778004770545711499635272857342051185669675206</span>, <span class="number">1487151272734883591621339384743729579702945226647848932314811332859011211687393769612</span>, <span class="number">1479191883622650407012568261078896124452298448888937784127270669623167501587692263629</span>, <span class="number">780856915459110484827869192135025240964695263399685896704373351690074659693517658597</span>, <span class="number">1272702898194178848480618231703540760239057875392727193937165056708655804663623414520</span>, <span class="number">1275195323347307250910668562396243097983325652451465111552014287378408554253858874273</span>, <span class="number">1698673537783777278793781484130287999078310462163146951845044095951885080758156044986</span>, <span class="number">1116043791065172596267818286071095315966453133595258493434104767743854595678117184595</span>, <span class="number">1348107024738703857635485943338711096444282613588540975344171990396347335813147110414</span>, <span class="number">674079263421647723071324170291511267338891718494055820365382788749002205059725239586</span>, <span class="number">295061829951102865059369162125524442985720861319812067484094160955682413284464056261</span>, <span class="number">1538215242227433291697344636690665676070219615083515667029553094023114463154050936814</span>, <span class="number">721505087135717334627356208457079819823654955152265437431617001188458058923464437209</span>, <span class="number">1829121734506718678607427505722187801463532440435031915402835074237985549711879794153</span>, <span class="number">641638098138302116745154827833695010970508819483215023447636503844550651793330508318</span>, <span class="number">578773085269354102367810984562000052879291442293349350198300750627238557013515250567</span>, <span class="number">1037095172573176620769108515135124799537948207093565906631598569276504664097088051993</span>, <span class="number">1135701773556587743998667090148858666225101588783019121910187176364233349468967967460</span>, <span class="number">558240645642302963325581107204211662019896908316831899444935081810819489268610165950</span>, <span class="number">1058477746525469710567689847282850794170250650192794892415352733735415750154044535539</span>, <span class="number">1078948952548590509616082107408254715684287170445966544383750373684441181406075608800</span>, <span class="number">1125503915235599245173592373330463888468814720113318696411329986853859005519154551245</span>, <span class="number">620937641933659718470519231175003762666892925875327642171561741417944681106496958467</span>, <span class="number">1606192912497675735832389346699475593863960301930109653069662356606234973780336341534</span>, <span class="number">1080665036256326887412273484626209788664633047255179233142423471463514811554155351816</span>, <span class="number">983009583253660084055702843297933007090244160053834934015802835528599935867335658914</span>, <span class="number">483554778736863191047830758397092863562079726548422384268968936073701177390747179894</span>, <span class="number">1448392838363784830874780455853191313920717249664981009097361707739423512768919183176</span>, <span class="number">1485175804980546607220269493098915446350406205462077528986751407380405658199537322034</span>, <span class="number">645127338301455578293193215328875283422934699182904112612610112081929081505533458304</span>, <span class="number">1809012351380435986646710932772127842855528298763939575266488725018536037784342688529</span>, <span class="number">1204732789391044629328843397205785308919820285525150764490536624969971871178313643864</span>, <span class="number">577072907834194443039001358264806817627199891744275024388326836994220595931009773412</span>, <span class="number">4850110449540994875278068624822977611188629104877448016749725577673217396499782282</span>, <span class="number">1431458221917644050146055837804453915809781510516096707298405324221753990760039183190</span>, <span class="number">997966793625232984798176686099411790420209217223783698909939651134351713786805317998</span>, <span class="number">1663286211430268448119727051818073243067649643181675027323547282932628837598336996456</span>, <span class="number">1864894557154744961308146774304105483911867578158330607820790060568575114233028842003</span>, <span class="number">345822843952211153189889023070066136116424104740167243049994988868945364800740535124</span>, <span class="number">803699468991667968627856232995969437316168483382073633967569490433608395707635458855</span>, <span class="number">1700532832517222239684444041937412551935144886911006116260771516969538181780787023704</span>, <span class="number">351624945474123146509460066647337532150453362002844376810733781394757015795554947704</span>]</span><br><span class="line">enc = <span class="number">463802484547898091835999726502006552543022358314700124374789687370275467670717610329</span></span><br><span class="line">mask = <span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line">mask_bits = <span class="number">280</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shash</span>(<span class="params">value,key</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">type</span>(value) == <span class="built_in">str</span></span><br><span class="line">    <span class="comment">#assert type(key) == int</span></span><br><span class="line">    length = <span class="built_in">len</span>(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    mask = <span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line">    x = (<span class="built_in">ord</span>(value[<span class="number">0</span>]) &lt;&lt; <span class="number">7</span>) &amp; mask</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> value:</span><br><span class="line">        x = (key * x) &amp; mask ^^ <span class="built_in">ord</span>(c)</span><br><span class="line"></span><br><span class="line">    x ^^= length &amp; mask</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"><span class="comment"># 提取测试样本</span></span><br><span class="line">s = testvalue[<span class="number">0</span>]</span><br><span class="line">h = testhash[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 初始化Z3求解器</span></span><br><span class="line">solver = Solver()</span><br><span class="line">key = BitVec(<span class="string">&#x27;key&#x27;</span>, <span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取测试样本</span></span><br><span class="line">solver.add(shash(s,key) == h)</span><br><span class="line"><span class="comment"># 求解密钥</span></span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">    model = solver.model()</span><br><span class="line">    <span class="built_in">print</span>(model)</span><br><span class="line">    key = model.<span class="built_in">eval</span>(key).py_value()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Recovered Key (hex): <span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>造格的重点是把异或看作加或者是减去一个值，并且这个值在-255到255之间。详细的造格说明可以参考<a target="_blank" rel="noopener" href="https://shinichicun.top/posts/ciscn2024-crypto/">CISCN2024-Crypto - Shin’s Blog</a>，这里不再过多赘述。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib, binascii</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># 输入数据（替换为实际数据）</span></span><br><span class="line">testvalue = [<span class="string">&#x27;tx4QYfj3lCTABrCoMsh3PPvQIM7dmIIw&#x27;</span>, <span class="string">&#x27;jKLrKVRVpjjyrchL41IjMVkQMgSkyyig&#x27;</span>, <span class="string">&#x27;fdbfg4185rfRJyhwCwc2flhmsCDuVOe8&#x27;</span>, <span class="string">&#x27;ZL8h1XOKVNXkVh1ZcCHhDUvF4FO96139&#x27;</span>, <span class="string">&#x27;HcDKLC1iMwoiWoGxaC5VNC78VHLt5JOI&#x27;</span>, <span class="string">&#x27;GzGJsONsN8GSZxh6C89w0nzRiTaR3tkj&#x27;</span>, <span class="string">&#x27;Qcc9vqEBGXYd8sZ3E94Ode6ChC3U53x7&#x27;</span>, <span class="string">&#x27;kABKm4mE7AttOzac3eBXvIxKE9Ve0viT&#x27;</span>, <span class="string">&#x27;IkxnSW31AuUGpVldXGopAxfzr5eTXc2u&#x27;</span>, <span class="string">&#x27;rJ2LZ0uDPCWEwJzaGGalaWWHBbxrLH4h&#x27;</span>, <span class="string">&#x27;bOlXdB5xVb2RQO0MAhLvzgOZpEo2hIdP&#x27;</span>, <span class="string">&#x27;gRhoDgyxFFV5kBLwZxexhoHNd5BD81UE&#x27;</span>, <span class="string">&#x27;Ij86fy7zhVOaapV76xI71IUC8utF6Ct6&#x27;</span>, <span class="string">&#x27;T055KPGIWKhNIEPxAKW4MLMbmWDvEnLb&#x27;</span>, <span class="string">&#x27;SQSSYTFryov8Bp1ckfjbUTTV8H3Z3Dr7&#x27;</span>, <span class="string">&#x27;AzfvT7z8NXJ9u8ID6vgJ8Zml58F2k0iF&#x27;</span>, <span class="string">&#x27;o3nEYw9XaNzgetmmwypTU7oePU04Tkhc&#x27;</span>, <span class="string">&#x27;B44YjfhqOrlPg8XQJq2fhWEoGaCijfsc&#x27;</span>, <span class="string">&#x27;b7cvfUfjvorVjDBW6DiXrZc3eBqx98Ro&#x27;</span>, <span class="string">&#x27;9MwfbmLtdmRRt0TONZ4zmd6NN7z7V8Eg&#x27;</span>, <span class="string">&#x27;2f7I0f65nopjOpIZzErAoqYSGl0tMo0x&#x27;</span>, <span class="string">&#x27;PqvrJ3FmEuJh1ASIQ06RyYCXbe6426CY&#x27;</span>, <span class="string">&#x27;c3C60OTDrIs5ZChP2hTAYvViDw43ARCK&#x27;</span>, <span class="string">&#x27;D6a0NJ2JpwtTBCRJdw1DcXntMgRRyj2A&#x27;</span>, <span class="string">&#x27;gJ0rEL4zyy8A6aKZ1H3N46rsQnY6UGGx&#x27;</span>, <span class="string">&#x27;CD19v37d2jHu9YZMp20h70sm1Q3t1yOm&#x27;</span>, <span class="string">&#x27;7vt0C1SCNvPBqBm0YrJffbeLG8vS8388&#x27;</span>, <span class="string">&#x27;o2KRrZQJLD7CMuLzlPJoJHXwVOHEanBi&#x27;</span>, <span class="string">&#x27;Lm8I9m5ikXVrguEUFKw6yIc9QWnLwisx&#x27;</span>, <span class="string">&#x27;kt9H0IDCsjCfqkR83aHD8D23jXq55q5K&#x27;</span>, <span class="string">&#x27;HsXBVD2dMVTScHfgwAeNsqHkLCWuuaVn&#x27;</span>, <span class="string">&#x27;QnkXRLGjzfh16icAVidcW4kVx1LEOv0j&#x27;</span>, <span class="string">&#x27;29dQWe0QWOxNAhv48Lfnv8II4IZqeUh1&#x27;</span>, <span class="string">&#x27;E9Hj5zUhGXUfrNJRmhxF0KfBq0wSjX0i&#x27;</span>, <span class="string">&#x27;mEc57IdmvliXneKStFzb3pAnNNm4UHbh&#x27;</span>, <span class="string">&#x27;TvRZb6btVQeKXsO5iVuRCdz3A4ORZ5yQ&#x27;</span>, <span class="string">&#x27;yOfrPTw9Vkd0P7kiijnGVYL4SogWF7cY&#x27;</span>, <span class="string">&#x27;GNI7o11w4RyXYY2hnxdq1mAeVPrppkRc&#x27;</span>, <span class="string">&#x27;YCMxUi7OcB5xozjTg09xXbJvwM6U4apy&#x27;</span>, <span class="string">&#x27;0g6ItBFoe3174e7wpEaEgoid0rixLHBs&#x27;</span>, <span class="string">&#x27;bsyXlUGPUnQjoNwQLROwrA2SCkbDR1k5&#x27;</span>, <span class="string">&#x27;CMNSNW3fU14ibZgL0ifWrA0xbbq7Yrks&#x27;</span>, <span class="string">&#x27;VHfbRmzF9mzGCbYySdljWWo08IVCmAMZ&#x27;</span>, <span class="string">&#x27;SLfmmSZ5TjDc4ZfKIB2gOVf9KIH2jDUi&#x27;</span>, <span class="string">&#x27;YKTagkUhZjI0gMyaE1YjVJdCYtPGPZge&#x27;</span>, <span class="string">&#x27;kCVhCGvjedxC44BlTqQryGdMliYqYrIz&#x27;</span>, <span class="string">&#x27;HflxuwlJZ2rByOnv995gpXz03ZK6MLW2&#x27;</span>, <span class="string">&#x27;8Yy45IMlpMhDO3CFVhr5f0iRBnNuj3ut&#x27;</span>, <span class="string">&#x27;Ydae2l7kt1O6mCIBRwjr6TWn6fLRHXjf&#x27;</span>, <span class="string">&#x27;3cLGeEXfyLnrL0ZkvgSEAbDBYgaFNFxB&#x27;</span>, <span class="string">&#x27;97xOFim3lkwqrWM1BqQ7c8mYo5S5TxkC&#x27;</span>, <span class="string">&#x27;U1EgvNhZz3M8Hg38FsuBVG0PvuWiCfez&#x27;</span>, <span class="string">&#x27;1elLy7dgdfEtb2XyZMxaU6h8dGjfokjv&#x27;</span>, <span class="string">&#x27;FlSHFSs2SeKNOUVAprkHdtD2FrIPUGIR&#x27;</span>, <span class="string">&#x27;Bu1pVMZ5QqMmvBTdUt4IwsTpkclqwQKF&#x27;</span>, <span class="string">&#x27;BPzJvHHDTAu23xBS1wVButTF7lU0JGoo&#x27;</span>, <span class="string">&#x27;6xje2blSl3QwGeV9D4pUmxMKJDqpyXpt&#x27;</span>, <span class="string">&#x27;F2DkyxkRcHotO6i5MVUKzzDsxV2F69wh&#x27;</span>, <span class="string">&#x27;kvSYBqmZNppDfweere2A8co50Tv85c4m&#x27;</span>, <span class="string">&#x27;9k5gxX8oz1WmVLtCcN4SdFIse2FizYDU&#x27;</span>, <span class="string">&#x27;BJ2PCD5KgukjFWntZ3VSjcHJzIZprno2&#x27;</span>, <span class="string">&#x27;Lyw9EacIjF6j6de3e5wFRQLdzrOfQoAR&#x27;</span>, <span class="string">&#x27;egf9LJLJrWDIrtnsHZ4XRgoPTXNsz91a&#x27;</span>, <span class="string">&#x27;Y3ptIW83Rwtny4kng2lCEAYQyPrSIXWl&#x27;</span>]</span><br><span class="line">testhash = [<span class="number">139452903649273495774796570198749847935154848275416989998236609393670079561796026566</span>, <span class="number">1898315960650462382992557075551445244853390783794354772475023552166352399126801574913</span>, <span class="number">1548283380348601157365276865178627465508293067676981633220766480841355279423253644108</span>, <span class="number">923519463377078549688929962730292019193308698763374121309865664233390770048594933085</span>, <span class="number">1756902502089018688726236312608077708484907801835749190713532913735823397112051091188</span>, <span class="number">485883566823442644293538461674550566921074196968613685770142417532151624958507107972</span>, <span class="number">1173292014155884160226339046019271687659068020981556335907768031140876583959335792191</span>, <span class="number">1497598230931219654402725391331476099708291441530945577907300933091011484442911623559</span>, <span class="number">405254852716971084666570344588562007424273706832802434925282540786042396564117859893</span>, <span class="number">1394088214004563872208003758992014976825245306078851263986862009024422531466462221196</span>, <span class="number">1763510459716348629512798257958014024443432479861579028783119470126357343664438877507</span>, <span class="number">27569271776233701581922903599984775754217802504994237075390721310066121958700422257</span>, <span class="number">358721799072196562200934505713368644637409165736588969777736471282788507457480492393</span>, <span class="number">393768200956019495628870433474843666326783653588854234548113046584760291662872350533</span>, <span class="number">1807499005738194381232046747643492968233097104171420081977957810644000450496758434126</span>, <span class="number">1128375044917910760907836056160281710737671148936596789317429758098492329675588054412</span>, <span class="number">190801904376187850882600897701548299608718300961575858190394579710450430805489346060</span>, <span class="number">696235869802737571933351613461601576350495964954926712734858661433694663819119664403</span>, <span class="number">144629031178782625524039663692148786536912021223673544659451459599242746855791775856</span>, <span class="number">401144481698447351083363386545760097487182143265029898145794033656496473914256697335</span>, <span class="number">1009618288798575771577716476700225261222418219966898563557126734083036472365735018549</span>, <span class="number">1652157599124169823165290864340613818899678030477803381010155627950330279311151902666</span>, <span class="number">1870720516435595720338243705356357230346778004770545711499635272857342051185669675206</span>, <span class="number">1487151272734883591621339384743729579702945226647848932314811332859011211687393769612</span>, <span class="number">1479191883622650407012568261078896124452298448888937784127270669623167501587692263629</span>, <span class="number">780856915459110484827869192135025240964695263399685896704373351690074659693517658597</span>, <span class="number">1272702898194178848480618231703540760239057875392727193937165056708655804663623414520</span>, <span class="number">1275195323347307250910668562396243097983325652451465111552014287378408554253858874273</span>, <span class="number">1698673537783777278793781484130287999078310462163146951845044095951885080758156044986</span>, <span class="number">1116043791065172596267818286071095315966453133595258493434104767743854595678117184595</span>, <span class="number">1348107024738703857635485943338711096444282613588540975344171990396347335813147110414</span>, <span class="number">674079263421647723071324170291511267338891718494055820365382788749002205059725239586</span>, <span class="number">295061829951102865059369162125524442985720861319812067484094160955682413284464056261</span>, <span class="number">1538215242227433291697344636690665676070219615083515667029553094023114463154050936814</span>, <span class="number">721505087135717334627356208457079819823654955152265437431617001188458058923464437209</span>, <span class="number">1829121734506718678607427505722187801463532440435031915402835074237985549711879794153</span>, <span class="number">641638098138302116745154827833695010970508819483215023447636503844550651793330508318</span>, <span class="number">578773085269354102367810984562000052879291442293349350198300750627238557013515250567</span>, <span class="number">1037095172573176620769108515135124799537948207093565906631598569276504664097088051993</span>, <span class="number">1135701773556587743998667090148858666225101588783019121910187176364233349468967967460</span>, <span class="number">558240645642302963325581107204211662019896908316831899444935081810819489268610165950</span>, <span class="number">1058477746525469710567689847282850794170250650192794892415352733735415750154044535539</span>, <span class="number">1078948952548590509616082107408254715684287170445966544383750373684441181406075608800</span>, <span class="number">1125503915235599245173592373330463888468814720113318696411329986853859005519154551245</span>, <span class="number">620937641933659718470519231175003762666892925875327642171561741417944681106496958467</span>, <span class="number">1606192912497675735832389346699475593863960301930109653069662356606234973780336341534</span>, <span class="number">1080665036256326887412273484626209788664633047255179233142423471463514811554155351816</span>, <span class="number">983009583253660084055702843297933007090244160053834934015802835528599935867335658914</span>, <span class="number">483554778736863191047830758397092863562079726548422384268968936073701177390747179894</span>, <span class="number">1448392838363784830874780455853191313920717249664981009097361707739423512768919183176</span>, <span class="number">1485175804980546607220269493098915446350406205462077528986751407380405658199537322034</span>, <span class="number">645127338301455578293193215328875283422934699182904112612610112081929081505533458304</span>, <span class="number">1809012351380435986646710932772127842855528298763939575266488725018536037784342688529</span>, <span class="number">1204732789391044629328843397205785308919820285525150764490536624969971871178313643864</span>, <span class="number">577072907834194443039001358264806817627199891744275024388326836994220595931009773412</span>, <span class="number">4850110449540994875278068624822977611188629104877448016749725577673217396499782282</span>, <span class="number">1431458221917644050146055837804453915809781510516096707298405324221753990760039183190</span>, <span class="number">997966793625232984798176686099411790420209217223783698909939651134351713786805317998</span>, <span class="number">1663286211430268448119727051818073243067649643181675027323547282932628837598336996456</span>, <span class="number">1864894557154744961308146774304105483911867578158330607820790060568575114233028842003</span>, <span class="number">345822843952211153189889023070066136116424104740167243049994988868945364800740535124</span>, <span class="number">803699468991667968627856232995969437316168483382073633967569490433608395707635458855</span>, <span class="number">1700532832517222239684444041937412551935144886911006116260771516969538181780787023704</span>, <span class="number">351624945474123146509460066647337532150453362002844376810733781394757015795554947704</span>]</span><br><span class="line">enc = <span class="number">463802484547898091835999726502006552543022358314700124374789687370275467670717610329</span></span><br><span class="line"></span><br><span class="line">mask = <span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line">mask_bits = <span class="number">280</span></span><br><span class="line">key=<span class="number">1000001</span></span><br><span class="line">var_names = [<span class="string">&#x27;v&#x27;</span> + <span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">33</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建多项式环（32个变量，系数为整数）</span></span><br><span class="line">R = PolynomialRing(ZZ, var_names)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取所有变量（按顺序）</span></span><br><span class="line">variables = R.gens()</span><br><span class="line">x = variables[<span class="number">0</span>] * <span class="number">128</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> tqdm(variables):</span><br><span class="line">    x = key * x + c</span><br><span class="line">coe = x.coefficients()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 造格</span></span><br><span class="line">t = (enc ^^ <span class="number">32</span>) &amp; mask</span><br><span class="line">M = identity_matrix(ZZ, <span class="number">32</span> + <span class="number">2</span>)</span><br><span class="line">bel = <span class="number">2</span> ^ <span class="number">500</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    M[i, -<span class="number">1</span>] = coe[i] * bel</span><br><span class="line">M[-<span class="number">2</span>, -<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">M[-<span class="number">1</span>, -<span class="number">1</span>] = <span class="number">2</span> ** <span class="number">280</span> * bel</span><br><span class="line">M[-<span class="number">2</span>, -<span class="number">1</span>] = -t * bel</span><br><span class="line">res = M.LLL()[:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span> i[-<span class="number">1</span>] == <span class="number">0</span> <span class="keyword">and</span> i[-<span class="number">2</span>] == <span class="number">1</span>:</span><br><span class="line">        res = i[:-<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="comment"># 还原key</span></span><br><span class="line">a1 = invert(key, <span class="number">2</span> ** <span class="number">280</span>)</span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res[::-<span class="number">1</span>]:</span><br><span class="line">    xa = (t - i) % (<span class="number">2</span> ^ <span class="number">280</span>)</span><br><span class="line">    x = t ^^ xa</span><br><span class="line">    flag += long_to_bytes(x)</span><br><span class="line">    t = (xa * a1) % (<span class="number">2</span> ** <span class="number">280</span>)</span><br><span class="line"><span class="built_in">print</span>(flag[::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h1 id="4，Noisy"><a href="#4，Noisy" class="headerlink" title="4，Noisy"></a>4，Noisy</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits, randint</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Noisy_cipher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, params</span>):</span><br><span class="line">        self.nbits = params[<span class="string">&quot;nbits&quot;</span>]</span><br><span class="line">        self.pbits = params[<span class="string">&quot;nbits&quot;</span>]//<span class="number">2</span></span><br><span class="line">        self.Mbits = params[<span class="string">&quot;Mbits&quot;</span>]</span><br><span class="line">        self.k0bits = params[<span class="string">&quot;k0bits&quot;</span>]</span><br><span class="line">        self.k1bits = params[<span class="string">&quot;k1bits&quot;</span>]</span><br><span class="line">        self.samples = params[<span class="string">&quot;samples&quot;</span>]</span><br><span class="line">        self.p = getPrime(self.pbits)</span><br><span class="line">        self.q = getPrime(self.nbits)</span><br><span class="line">        self.n = self.p * self.q</span><br><span class="line">        self.s = randint(<span class="number">0</span>, self.n)</span><br><span class="line">        self.M = getrandbits(self.Mbits)</span><br><span class="line">        self.pubKey = [self.n]</span><br><span class="line">        self.priKey = [self.s, self.p, self.M]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self,msg</span>):</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.samples):</span><br><span class="line">            k0 = getrandbits(self.k0bits)</span><br><span class="line">            k1 = getrandbits(self.k1bits)</span><br><span class="line">            ci = self.s * (msg[i] + k0*self.M)*(<span class="number">1</span> + k1*self.p) % self.n</span><br><span class="line">            res.append(ci)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;nbits&quot;</span>:<span class="number">1024</span>,</span><br><span class="line">        <span class="string">&quot;Mbits&quot;</span>:<span class="number">30</span>,</span><br><span class="line">        <span class="string">&quot;k0bits&quot;</span>:<span class="number">30</span>,</span><br><span class="line">        <span class="string">&quot;k1bits&quot;</span>:<span class="number">512</span>,</span><br><span class="line">        <span class="string">&quot;samples&quot;</span>:<span class="number">20</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    mbits = <span class="number">24</span></span><br><span class="line">    Noise = Noisy_cipher(params)</span><br><span class="line">    n = Noise.n</span><br><span class="line">    msg = [getrandbits(mbits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(params[<span class="string">&quot;samples&quot;</span>])]</span><br><span class="line">    cipher = Noise.encrypt(msg)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;secret.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        flag = file.readlines()[<span class="number">0</span>].encode()</span><br><span class="line">    file.close()</span><br><span class="line">    key = md5(<span class="built_in">str</span>(msg).encode()).digest()</span><br><span class="line">    aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    encrypted_flag = aes.encrypt(pad(flag, <span class="number">16</span>)).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(<span class="string">&#x27;n = &#x27;</span> + <span class="built_in">str</span>(n) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;c = &#x27;</span> + <span class="built_in">str</span>(cipher) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;encrypted_flag = &quot;&#x27;</span> + encrypted_flag + <span class="string">&#x27;&quot;\n&#x27;</span>)</span><br><span class="line">    file.close()</span><br></pre></td></tr></table></figure>

<p>大概看一眼题目代码不难发现重点是这一行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ci = self.s * (msg[i] + k0*self.M)*(<span class="number">1</span> + k1*self.p) % self.n</span><br></pre></td></tr></table></figure>

<p>展开改写一下得到</p>
<p>令x&#x3D;m+k$_0$·M.可以写成x+k$_1$x · p mod n，并且我们已知n&#x3D;pq，这就转化成了一个PACD问题，可以使用正交格的方法求解，可以参考<a target="_blank" rel="noopener" href="https://tanglee.top/2023/12/12/Orthogonal-Lattice-Attack/">格密码分析：正交格攻击 | tl2cents blog</a>，值得注意的是正交格规约出来是与原向量垂直的向量，所以要求我们想得到的结果需要对造出的格求一个right_kernel()。然后就能得到x，且x&#x3D;m+k$_0$·M，那就是一个AGCD了，也是正交格去打。</p>
<p>那么就可以写出代码啦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flatter</span>(<span class="params">M</span>):</span><br><span class="line">    <span class="comment"># compile https://github.com/keeganryan/flatter and put it in $PATH</span></span><br><span class="line">    z = <span class="string">&quot;[[&quot;</span> + <span class="string">&quot;]\n[&quot;</span>.join(<span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, row)) <span class="keyword">for</span> row <span class="keyword">in</span> M) + <span class="string">&quot;]]&quot;</span></span><br><span class="line">    ret = check_output([<span class="string">&quot;flatter&quot;</span>], <span class="built_in">input</span>=z.encode())</span><br><span class="line">    <span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line">    <span class="keyword">return</span> matrix(M.nrows(), M.ncols(), <span class="built_in">map</span>(<span class="built_in">int</span>, findall(<span class="string">b&quot;-?\\d+&quot;</span>, ret)))</span><br><span class="line"></span><br><span class="line">n = <span class="number">931345196654137409294197135173149859904800504387235031569844050477816805471659477549867345780405716254835453866134323419945309131852465776955243829422305657434938224724478007837188982154686395040152421927773513751675951117273164534599361707388401754689467232293524773873081390900445460751849312463853674644147032417729111218144080786016585938118028106088150701390374246123227343653724932824469200315405886227541178516859510470438102946063729298109789753400535413</span></span><br><span class="line">c = [<span class="number">44393461469135749552341687573367202324883191440583805973792574295302702852134846481849103946409919792057095346990009804033846370311582900685718559323930567746395228471258159648661807580463697803841730176308557755645476991733346247396500365688994367463153020886602899611038036228481769117396526392280614311463280399494133571801648415803508402241721480392296346279553729911935412665319929139397699629742042460689944378768977129239396836317204774266638191562623642</span>, <span class="number">539920802606578584210996520924579291346905910518135607177245745820517711828351507337959361269794979842233434156795677265464942949246448433197513954168602625494100194699716593500051960783605835250817713574311904996510832420400834091420622842541472830357072621740148258698642873008987856098015262213586418636597458173855887200534596678693164065907611865092804827249866719338749882553240206311618656611195747325612206359345586978029288254676405381961327252078121227</span>, <span class="number">912969253027180152302008239757950557255143999987684345824704782128308837709443475359601738962500473197792984510949472765652709449576511551753476192189067928236825729802081544313577905638454269321307806960030818401241547153518148752380077970852835890206560157651154083006318242420498917321741946345422908249723406759064990622534934300768889856495669567881646449061735911544207219295421775183342850849511318455169459802392153404840292256588462238484017184070439058</span>, <span class="number">704129339391476902834623647545050360055052560918471812433439198050896702771009034197961257854439637856923149427107485450685758012059915229254711158222062274633832027255279885472858093979886344455603364752039574393763740089052781056817698204632985382283135005709245118795006715288914374917267774490980643965855806763792705970367942842066301900528153149411886703069237980512017698620265259775250207231454943195707701376131205089963780783194378880892920761769396376</span>, <span class="number">75233039998980230184893215882867932908211138581464925469465529257051933026745951594054393764107823684556757549941976687507867860435869332829256074033281246343192963839759052028459631662209667578023008295444423181997621348563199183346960455353232990885813330466287295547759326363405275137501042528970911270222207659932659495447106007866559948214804837910916964981447827647966841595069719238014777879036315306528393822101416510360429475270780316967314977212062479</span>, <span class="number">461423095526820857155507142909810859741993739691637425310258711373657533005997947691887212668647744754708998545032230990008781169413674049824069040664094391313692719411542897396557436563635856225821281279781008700827315066631377604685721697875513442045633625509355719320731049790871449432502165309335238486557551797017798444889669487248744419599481849250280233778118639348019549912963106101292147155681429237126220845262529135044627852020816746814659384780280973</span>, <span class="number">367364572148059002452458378431919918417128457895918835895792042718588658184890998070524174563741131829770068017761303942083521976211260357518337046963857857923796113599655185025979061513594565985351757490979954268209182516032134979103468620018163916908405334869466018019365868158827852395987531538640537494591839876488794094867513081526454002977847709327257947076683213914991119173347188654815917923371430774772220979039309203396300178280207360538444565566020299</span>, <span class="number">904463452273264226577027020039531313648975201538158946181894446099560257332044693934142997946585244486522386003568254369400502693137880071694551015943027552207478494112177186465294633752846739107117260820777505887557669953162522289988781935162572334120761828958346938610998284198883207252030818244320266796588782628679469599573621141532731189668347726613589688599907757436810708578278511123476853464661969249807190793933642629049121152594554138741064353908267527</span>, <span class="number">905416992071609918194286515398185039717046426602235967032724042039427878441223712019928849846046512156035414203668484273724435007867326197142639578134394106888412651336818885397451910937280467497797130716216468206865920691694792412526665587970431309296769222651386297077280003604436310714741049806737139142445245569932908914027744645513522958423615830744399292707462525246610072828618152626530619477149886211241901531983934546033687698719922827074723162112877139</span>, <span class="number">452643031792027333761138831146502956340724720315042375737589105675038921336234007024472026194106213621694017814735826360779159432111610885222090540082603623837117068711452615521100137223909708233119331357716789686350547309821120723790772118708237069207516678406654282702496219667506339320212014846049065105749599898166761195573717057859137983450296304872572871751663468743347535459305514224218500703387571202207027664726341715849324032699940941905839302766827499</span>, <span class="number">212673278087605343276071433314325651822590138814583835769266435297532085609513722222971062796758536350174937826257599823800561305906518757901728127745886814862639273759236069230910033612691903488587337500974112537248366383295461678533905165374092697347321036155866150099809018499951162533765210416850725766195148466913723342201317273777814265581791043948667692208912085197333559714555752788986641645892112079484237438406289333978097134665465890869117192499040078</span>, <span class="number">618885378867829225574384501430248365944801981788397398087382860821512631127016396693744705104921139258471344898496683075139334050462054819762115919159392842707178868016697534175927650393416588623170936742373077805758963002568768267797843281721972800997172099222722029886235184148160770288591312377965422085410302286242604988405174145979590045724258072059745959840087044435085850665653201438615483013012669624865477331056502564666781619316693156013842919938163321</span>, <span class="number">247541522606162447639301360070006352189819939226525086556447182525813620932850763368793482733250887839896454988833382645818017844366921462117689698250456542373028553792898964827039839763697407818465152532046980456227414222696647288759140238333732153522322593390570208339332394637394873323773760730999003953875961526476008886559596300228049432970064036768172196837050887080432644677813778844185851969703026669069770482802366425198959039311171290582323970136971886</span>, <span class="number">908018178869624877463246006010850998859189967677977854520359272664016848400825720425780329121594793126516838777613620596508996703936445567812415853284383999097120944182957514958755630252556706588567697742822534195073018061427160931816814733075736791598346359735687960831673101184689094229555577585585923791489244865110884570860216605752334625663191443649941759569007973564548438436441428870306894238322372831477776218474307399183417368990004923389659543747195296</span>, <span class="number">366523156922156965821828874107564478788643127754015557590598074555449309032008658382486713007501973690333305257733148972529467963882646318977084677556747090610737208466813471179929722614677159741828176112063648755272191520333104369216677948221832614065957220855992127171151122742679465992969209100579420456272759494150603308918209213782654566120728303606840200883548862818260127217153333990531566636412609141292951607073854516504587688328356290301197508841143741</span>, <span class="number">639406992161231079019948085936226229300789127373562729169611827945671359155688049810884857367876003831554226874585473740231752445953638246901220714046836671336883740086166378134402994243966696885331702926066667688733147620400909589757552630021877907871711728497089853311096298440658356847718920978470275256185444145070691778883308538596800581292775537884030859076294618094092471841198971413069838393993348287099841406516752971246902464209608259286659436366564130</span>, <span class="number">174788516082730477653159546514041816772418089789276014413831566132969570738198961172185399940444613359439932847237594496731166190833395423296555364488106067480663357216325505878919022799798056746312098513235963582560821318135335749507326788293491822146649158662575138071628748364257596420485792422257187406205492351506462873966550421052920225650910969287505948086603766444926390024169074853316825113026820782720738096044454079119560396182767773276067915935620838</span>, <span class="number">692122366621668667934219623781427243412441522160495343734761009370335228032983188772200711284859681304604759206913240934049495316525633233831165309292048163807009060066877565588518825399293683925724650068090938676695109266471854850233584663313868765863440164620682884162805086273022432479339558553205180790661279541212760937139848506839349409774335221610460173306469631751320521446368124215699897055036629272579050909508624189106164372746898653884579369739300732</span>, <span class="number">655458433272866580956847752295203248320777879825112389989922084544791554484471603499617539316146184842569741790211263945397678411830636036184289378485001841639074371604764089931122272819428308907402735409020487920248536050013994567271676166709669489791796881195493234306692941286104370305393726294538393465256528119230161794643693614527801553094915478577302812822235536872500554436063474907280123259938377500419679054323084985978824524145718399076476333347704243</span>, <span class="number">469953808456651804146000233164086224981688489612248280585566256224965907341271421402496612389906809620564044789407968371121708170572023237144917029355521900919148351696528608187440824844352038236393593068104904053288525955999815309158295080405407971397111278262543364815818529357051823886830084476645557683307203866337081517030832639815424599514896405759257146192241829045108758822206019067643000025217245916174241352087766812082643533881822356002925358883319804</span>]</span><br><span class="line">encrypted_flag = <span class="string">&quot;3627c955f73257f3253e1ab1d0d9489da506d71bf670776a005fb44bab85fa2d&quot;</span></span><br><span class="line">cipher = <span class="built_in">bytes</span>.fromhex(encrypted_flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################### step1 PACD</span></span><br><span class="line">l = <span class="built_in">len</span>(c)</span><br><span class="line">c_vec = vector([(-c[i] * invert(c[-<span class="number">1</span>], n)) % n <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l-<span class="number">1</span>)])</span><br><span class="line">L = identity_matrix(l - <span class="number">1</span>).augment(c_vec)</span><br><span class="line">L = L.stack(vector([<span class="number">0</span>] * (l - <span class="number">1</span>) + [n]))</span><br><span class="line">u = L.LLL()[:-<span class="number">2</span>]</span><br><span class="line">r = Matrix(u).right_kernel().matrix()[<span class="number">0</span>].<span class="built_in">list</span>()</span><br><span class="line"><span class="comment">#p = GCD(c[1] * r[1] - c[2] * r[0], n)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################### step2 GACD</span></span><br><span class="line">l = <span class="built_in">len</span>(r)</span><br><span class="line">alpha = <span class="built_in">int</span>(<span class="number">2</span> ** <span class="number">24</span>)</span><br><span class="line">A = vector(r)</span><br><span class="line">L = identity_matrix(l).augment(Matrix(alpha * A).T)</span><br><span class="line">t = L.LLL()</span><br><span class="line">V = [x[:-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> t[:-<span class="number">2</span>]]</span><br><span class="line">t = Matrix(V).right_kernel().matrix()</span><br><span class="line">r = t.LLL()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################### step3 get flag</span></span><br><span class="line">msg = r.<span class="built_in">list</span>()</span><br><span class="line">key = md5(<span class="built_in">str</span>(msg).encode()).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">flag = aes.decrypt(cipher)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>(不过不知道为什么flatter犯病了，明明其他用flatter的脚本都能跑偏偏这个跑不出，只能改成正常的LLL了qaq)</p>
<p>(还有两道先咕咕)</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/WP/" rel="tag"># WP</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/04/29/ACTF2025%E5%A4%8D%E7%8E%B0/" rel="prev" title="ACTF2025复现">
                  <i class="fa fa-angle-left"></i> ACTF2025复现
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/05/27/%E7%AC%AC%E4%B8%89%E5%B1%8A%E9%BB%84%E6%B2%B3%E6%B5%81%E5%9F%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B/" rel="next" title="第三届黄河流域网络安全技能挑战赛">
                  第三届黄河流域网络安全技能挑战赛 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">mi1n9</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">577k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">17:28</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
